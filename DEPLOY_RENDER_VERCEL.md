# Deploy: Render (Server) + Vercel (Client)

Quick, minimal steps to go live.

## 0) Prereqs
- GitHub repo connected: JaekwonJo/league-of-english
- OPENAI_API_KEY ready

## 1) Server on Render
1. Go to Render ??New ??Blueprint ??select this repo.
2. Ensure `render.yaml` is detected (root). It provisions a Node web service.
3. Set environment variables:
   - OPENAI_API_KEY: your key
   - (auto) JWT_SECRET: generated by blueprint
   - (auto) DB_FILE: `/var/data/loe.db`
4. Deploy. After first deploy, copy the service URL, e.g. `https://loe-server.onrender.com`.

Notes
- Persistent disk is configured at `/var/data` so SQLite survives restarts.
- Health: GET `/health` should return `{ status: 'OK' }`.

## 2) Client on Vercel
1. Import GitHub project.
2. Root Directory: `client`
3. Build Command: `npm run build`
4. Output Directory: `build`
5. Environment Variables:
   - `REACT_APP_API_URL` = `https://<render-service-domain>/api`
6. Deploy.

## 3) Test Flow
- Visit the Vercel URL.
- Login: `admin / admin123`
- Study ??select a document ??pick 3?? items ??Start ??Submit.
- Expect: results page with points/tier.

## 4) Optional
- Custom domain: attach to both Vercel (client) and Render (server) and update `REACT_APP_API_URL` accordingly.
- CORS: if needed, set `CORS_ORIGIN` (comma-separated) on the server to lock down origins.

## Troubleshooting
- 503 on generation: retry once; AI-only policy may need a second call.
- 404 on submit: ensure server deployed with latest routes (problem.routes.js includes /problems/submit).
- CORS errors: set `CORS_ORIGIN` on server to the Vercel domain, redeploy.


## Free vs Starter on Render
- Free tier: no persistent disk. Use DB_FILE=/tmp/loe.db (already set in render.yaml). Data resets on redeploy/instance recycle; fine for demos.
- Starter tier: supports persistent disk. If you upgrade plan, set DB_FILE=/var/data/loe.db and add disk block:

``yaml
services:
  - type: web
    name: loe-server
    env: node
    plan: starter
    buildCommand: npm install
    startCommand: node server/server.js
    envVars:
      - key: DB_FILE
        value: /var/data/loe.db
    disk:
      name: data
      mountPath: /var/data
      sizeGB: 1
``

Adjust CORS_ORIGIN to your Vercel domain for production. 
