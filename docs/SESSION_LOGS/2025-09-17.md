# Session Log — 2025-09-17

Commits
- 2c23853 chore(lock): update package-lock for sql.js; fixes Render npm ci mismatch
- 7f05d79 fix(server): add grammarSpanGenerator util and include choices for grammar_span; fix MODULE_NOT_FOUND on Render
- 0f6b8ed fix(server): remove broken unicode fallback in grammar_span choices; use generator-provided choices only

What changed
- Fixed Render build by syncing lockfile (sqlite3 → sql.js).
- Added grammar span generator util; routes now send `choices` for grammar items.
- Removed unicode fallback causing parse errors.

Where we are
- Server: builds and runs with sql.js; grammar routes stabilized.
- Client: pending Vercel redeploy with Root=`client` and `REACT_APP_API_URL` env.

Next
- Switch Render to Starter + Disk (`DB_FILE=/var/data/loe.db`) for persistent DB.
- Redeploy client from latest commit; verify Study flow end-to-end.

## Later Updates (evening)
- Added missing route modules (adge, inquiry, dmin, ocab) so Render no longer crashes on deploy.
- Updated Study API default URL to Render domain; Vercel now talks to production server.
- Normalizer now keeps order/insertion fields so CSAT set returns those problems again.
- StudyPage now uses apiService.post for CSAT set generation (fixes TypeError in browser).

Next
- Verify order/insertion rendering end-to-end on prod after redeploy.
- Watch Render logs for normalization warnings; adjust generators if needed.
- Schedule DB backup from /var/data/loe.db after first student session.
