# PROJECT_STATE.md

## 우리가 만드는 것
- PDF나 텍스트 지문을 업로드하면 **수능 스타일 문제·해설·분석**을 자동으로 만들어 주는 학습 플랫폼.
- 학생은 웹에서 문제를 풀고 채점·해설·랭킹·신고 기능을 이용할 수 있어요.
- 선생님(관리자)은 분석본을 검수하고, 마음에 들지 않는 변형을 삭제하거나 신고를 처리할 수 있어요.

## 기술 스택 & 핵심 명령어
- **백엔드**: Node.js 20 + Express, SQLite(sql.js) / OpenAI API (fallback은 WordNet + 자체 로직)
- **프런트엔드**: React 19 (CRA), Zustand + SWR
- **공통 명령**
  - 개발: `npm run dev:all` (백엔드 5000, 프런트 3000)
  - 테스트: `npm test`
  - 프런트 빌드: `npm run build`
  - 린트: `npm run lint`

## 최근 결정/하이라이트
- 분석 자료 리스트/상세 화면을 다크 톤 카드로 재정비하고 `document_passage_labels` 테이블을 붙여 지문 표시 이름을 저장·수정할 수 있게 했습니다.
- VocabularyPage 히어로를 단순 안내 + CTA 구조로 정리해 “총 Day/누적 단어” 같은 혼란스러운 통계를 제거했습니다.
- 랭킹 페이지 상위 카드의 대비, 이름 색상, 실버 티어 배지를 🥈로 교체해 어두운 배경에서도 1~3위 이름과 LP가 선명하게 보입니다.
- mockExamService가 PDF를 찾지 못하거나 `pdf-parse`가 실패하면 기본 JSON 데이터를 자동으로 사용하고, `모의고사원문`·`모의고사 원문` 폴더 모두를 탐색하도록 보강했습니다.
- 분석 생성 프롬프트와 폴백 로직을 전면 개편해 문장별 해석·배경지식·사례·어휘 포인트·응원 이모지가 포함된 “교수님 매뉴얼” 포맷을 항상 보장합니다.
- AnalysisPage 상세 보기 UI를 동일 템플릿으로 리팩터링해 ①~⑳ 번호, 배경/사례 하이라이트, 어휘 표/동의어·반의어가 앱에서 그대로 노출됩니다.
- OpenAI 키 없이도 빠르게 결과를 받을 수 있도록 분석 폴백이 번역 호출을 생략하는 “Fast mode”로 동작하게 조정했습니다.
- 워크북 학습 메뉴가 분석 데이터를 활용해 자동으로 10단계 카드·미션을 생성하도록 서버/클라이언트 파이프라인을 구축했습니다.
- `/api/workbooks` REST 엔드포인트와 `workbook_sets` 테이블을 신설해 생성/조회 결과가 DB에 영구 저장됩니다.
- 라이트 모드 색상 팔레트를 재정비해 사이드바·카드·안내문이 모두 높은 대비로 표기됩니다.
- 어휘·학습·분석 화면을 단계별 URL(`/vocabulary/days`, `/study/solve`, `/analysis/detail`)로 분리해 브라우저 뒤로가기·딥링크를 지원합니다.
- StudyPage의 브라우저 히스토리 처리(`popstate`)를 안전한 순서로 재구성해 ReferenceError 없이 복귀/다시풀기 흐름이 동작합니다.
- 모바일 헤더/사이드바는 단일 토글과 outside-click 감지로 UX 혼선을 없앴습니다.
- 분석/관리자 리스트 UI를 고대비 카드·그라데이션 톤으로 통일해 모바일과 데스크톱 모두 같은 톤앤매너를 유지합니다.
- AnalysisPage와 VocabularyPage 상단 히어로를 메트릭 배지·검색 안내가 포함된 고대비 그라데이션 영역으로 재구성해 첫 화면에서 핵심 정보를 또렷하게 제공합니다.
- 모의고사 실전 모드(50분 타이머, 채점/복습, 프로 전용 AI 해설)를 구축해 학생이 바로 시험을 볼 수 있습니다.
- 관리자 페이지에 모의고사 문제지·정답 PDF 동시 업로드 기능을 추가해 실전 데이터를 코드 수정 없이 갱신할 수 있습니다.
- 홈 대시보드 히어로/하이라이트/CTA를 네이비·골드 팔레트와 미니 메트릭 카드로 재구성하고, wink/cheer 루프 애니메이션으로 브랜드 톤을 한 화면에서 전달합니다.

## Resolved (오늘)
- 로그인 화면에 “아이디 찾기(이메일 입력→안내 메일 발송/화면 안내)”를 추가했습니다. 서버: POST `/api/auth/find-id`.
- 분석/워크북에서 한글 해석·문장 분석 라벨이 중복 표기되던 문제를 제거했습니다(서버 클린업 + 클라이언트 스트립).
- 학습(문제풀이) 본문 줄바꿈이 어색하던 이슈를 `word-break/overflow-wrap`으로 개선하고 밑줄 가독성을 높였습니다.
- 상단 로고(독수리/타이틀)를 클릭하면 언제나 홈으로 이동하도록 반영(모바일 상단 바 포함).

## Next 3
1) P0 어법/어휘 검증 강화: 밑줄 길이·다중 정답 불일치·출처 불일치 시 자동 재생성(정확도 향상 최우선).
2) P1 모의고사 실서버 점검: Render 응답 지연/401 케이스 CORS·토큰 로깅/우회(사용자 무한 대기 제거).
3) P1 모바일 성능 튜닝: 저사양 기기에서 애니메이션 빈도/크기 자동 저감(가독성 유지, 배터리 절약).

## 현재 단계 (2025-11-06 기준)
- 분석 생성과 프런트 렌더링이 교수님 매뉴얼 포맷(배경지식/사례/어휘/응원 이모지)으로 고정돼 학생 보기와 관리자 검수가 동일한 결과를 확인할 수 있습니다.
- 워크북 학습·테스트 파이프라인이 서버 DB와 연결되어 카드 학습 → 테스트 → 채점 흐름을 일괄 관리합니다.
- 어휘/학습/분석 단계가 주소로 분리되어 모바일·데스크톱 모두 브라우저 네이티브 전환감을 제공합니다.
- 라이트/다크 테마 대비가 정리돼 사이드바·단계 안내문·빈 상태 안내가 모두 높은 시인성을 가집니다.
- 학습 페이지의 히스토리 이동이 ReferenceError 없이 작동하며, 저장된 세션 복원도 안정화되었습니다.
- 모의고사 실전 모드가 PDF 파싱 → 타이머 → 채점 → 프로 전용 해설까지 한 플로우로 제공되어 베타 시험 리허설이 가능합니다.
- 관리자 포털 UI가 고대비 카드 스타일로 정리돼 문서/모의고사/신고 보드를 일관된 UX로 운영할 수 있습니다.
- 분석 자료 히어로 · 지문 카드가 다크 톤으로 정리돼 등록된 문서 수와 CTA만 노출되고, VocabularyPage 히어로도 단순 CTA 구조로 통일되었습니다.
- 지문 라벨 편집은 모달 입력과 `document_passage_label_logs` 감사 로그를 남겨 누가 어떤 이름을 적용했는지 추적할 수 있습니다.
- 자동 배포(Render/Vercel)는 토큰·시크릿 보강 이후 연결 예정이며, GitHub Actions에서 Playwright E2E를 돌려 스냅샷을 남깁니다.
- 모의고사 제출 결과가 study 기록·랭킹·학습 통계에 반영되어 LP와 유형별 정확도가 즉시 업데이트됩니다.

## Next 3 (오늘 우선순위)
1. [P0] 문제 생성 검증 강화 – 어휘/어법 자동 생성 시 잘못된 밑줄·다중 정답·출처 불일치 재시도 규칙을 추가(품질 상향).
2. [P1] 모의고사 실서버 가용성 – Render 응답 지연/401 시 프런트 즉시 오류 노출 + 기본 회차 폴백 로딩, CORS/토큰 점검.
3. [P1] UI 성능 튜닝 – 모바일에서 애니메이션 빈도·크기를 단말 성능에 맞춰 조절(선호도/감속 설정 반영).

## Known Issues
- Playwright E2E는 CI에서 실행되지만, 샘플 데이터가 없으면 초기 부트스트랩이 실패할 수 있어 자동 시드가 필요합니다.
- 랭킹 API는 실제 학습 데이터가 적재되기 전까지 데모 순위/티어 분포(폴백)를 반환합니다.
- 지문 이름 변경 이력은 DB에 기록되지만, 관리자 UI에서 조회/롤백할 수 있는 화면이 없습니다.
- 모의고사 업로드는 현재 단일 회차(`2025-10`)만 지원해 다회차 관리 UI가 필요합니다(목록/응시 자체는 다회차 지원 완료).
- Workbook bulk 생성 결과 알림은 로그 중심이라 UI에서 실패 건수를 바로 확인하기 어렵습니다.
- SMTP 자격 증명이 없어 이메일 인증/비밀번호 초기화를 베타 우회 채널로 처리합니다.

## Resolved – 2025-11-10 (오류 반복 방지)
- 홈 히어로의 독수리(마스코트) 크기를 데스크톱/모바일 모두 축소해 첫 화면 집중도를 높였습니다.
- 어휘 훈련 히어로 문구를 간결화하고(“핵심 어휘를 정확하게 훈련합니다”), 안내 문구를 시험/연습 모드 즉시 시작으로 정리했습니다.
- 어휘 히어로의 캐릭터 이모지(🦅)를 제거하고 모바일 크기를 축소, Day 돌아가기/다시 선택 버튼 가독성을 키웠습니다.
- 분석 자료 카드 색을 한 가지 차분한 그라데이션으로 통일하고, 학생 계정에서 이름 수정/삭제 UI가 보이지 않도록 보강했습니다.
- 한글 해석/문장 분석 중복 표기를 제거(라벨 접두어 자동 제거)해 같은 문장이 2~3회 반복되는 문제를 해결했습니다.
- 워크북 보조 버튼(퍼즐 초기화/이전/다음/완료 체크) 대비를 높였고, 영작(8단계)에 단어 힌트 토큰을 추가했습니다.
- 프리미엄 이상 학생도 워크북 생성이 가능하도록 권한을 조정하고, 프로필 프리미엄 혜택에 워크북/모의고사를 명시했습니다.
- 모의고사 목록 로딩 실패 시 기본 회차(`2025-10`) 폴백 + 오류 노출로 무한 로딩을 방지했습니다.

## Resolved – 2025-11-09 (오류 반복 방지)
- GitHub Actions CI에서 Playwright 브라우저 설치→`npm run test:e2e`까지 자동 실행돼 릴리스 전 회귀 캡처를 남깁니다.
- passage label 편집이 모달 + 길이 검증 + 감사 로그(`document_passage_label_logs`)로 동작해 모바일/IME 대응과 이력 추적이 가능해졌습니다.
- 모의고사 제출이 `mock_exam_questions`/`study_records`와 연결되어 학습 통계·랭킹·유형별 정답률에 즉시 반영됩니다.
- VocabularyPage Day 선택 효과를 강화(체크 배지, 플래시)하고 우하단 플로팅 CTA를 도입해 스크롤 중에도 다음 단계가 보장됩니다.
- 주기적 눈 깜빡임/날개 플랩/탭 점프 상호작용으로 모바일에서도 상징 요소의 생동감을 높였습니다.
- 모의고사 플레이어에 모바일 하단 고정 바(타이머+제출)를 추가하고, 하단 문항 네비 바와의 겹침을 방지하도록 위치를 조정했습니다.

## Resolved – 2025-11-08 (오류 반복 방지)
- 홈 히어로·하이라이트·CTA 컬러를 네이비/골드 팔레트로 재정비해 베타 사용자에게 일관된 브랜드 인상을 줍니다.
- 빠른 실행 버튼을 아이콘+텍스트 구조로 재구성해 모바일에서도 각 기능이 한눈에 들어오도록 했습니다.
- 마스코트 애니메이션을 wink/cheer 루프와 오라/그림자 레이어로 보강해 “멈춰 있는 캐릭터”처럼 보이던 문제를 제거했습니다.
- 단어장/모의고사 Playwright 시나리오를 추가해 업로드→응시→제출 흐름이 자동으로 검증됩니다.
- 지문 이름 편집을 모달 UI로 교체해 모바일/IME 환경에서도 끊김 없이 수정할 수 있습니다.
- 랭킹 API가 데이터 부족·쿼리 오류 시 안전한 폴백 순위표/티어 분포를 돌려 홈 위젯이 500 없이 동작합니다.

## Resolved – 2025-11-07 (오류 반복 방지)
- 분석 자료 리스트/상세를 다크 톤 카드 + `document_passage_labels` 기반 이름 편집으로 재구성해 지문 라벨 혼선을 없앴습니다.
- VocabularyPage 히어로를 안내 + CTA만 남기는 구조로 바꿔 “총 Day/누적 단어” 같은 불명확한 통계를 제거했습니다.
- 랭킹 페이지 상위 카드 색 대비와 실버 티어 아이콘을 갱신해 1~3위 이름/LP가 어두운 배경에서도 선명하게 드러납니다.
- mockExamService가 PDF 경로를 찾지 못하거나 파싱에 실패하면 JSON 데이터를 자동으로 사용하고, `모의고사원문`/`모의고사 원문` 폴더 모두를 검사해 Render 500을 예방합니다.

## Resolved – 2025-11-06 (오류 반복 방지)
- AnalysisPage·VocabularyPage 히어로를 고대비 그라데이션과 메트릭 카드로 리뉴얼해 다크/라이트 테마 모두에서 지표가 선명하게 보입니다.
- 분석 자료·관리자 리스트를 고대비 카드 UI로 통일해 테마 혼선과 모바일 대비 부족 문제를 제거했습니다.
- 모의고사 실전 모드를 구축해 PDF → 문제/정답 파싱, 50분 타이머, 채점/복습, 프로 전용 AI 해설까지 한 플로우로 제공합니다.
- 관리자 페이지에 모의고사 문제지·정답 PDF 동시 업로드를 추가해 코드 수정 없이 실전 데이터를 갱신할 수 있습니다.
- MockExam 서비스가 캐시 리셋/파일 검증을 수행해 누락된 PDF나 잘못된 업로드로 인한 500 오류를 예방합니다.
