# PROJECT_STATE.md

## 우리가 만드는 것
- PDF나 텍스트 지문을 업로드하면 **수능 스타일 문제·해설·분석**을 자동으로 만들어 주는 학습 플랫폼.
- 학생은 웹에서 문제를 풀고 채점·해설·랭킹·신고 기능을 이용할 수 있어요.
- 선생님(관리자)은 분석본을 검수하고, 마음에 들지 않는 변형을 삭제하거나 신고를 처리할 수 있어요.

## 기술 스택 & 핵심 명령어
- **백엔드**: Node.js 20 + Express, SQLite(sql.js) / OpenAI API (fallback은 WordNet + 자체 로직)
- **프런트엔드**: React 19 (CRA), Zustand + SWR
- **공통 명령**
  - 개발: `npm run dev:all` (백엔드 5000, 프런트 3000)
  - 테스트: `npm test`
  - 프런트 빌드: `npm run build`
  - 린트: `npm run lint`

## 최근 결정/하이라이트
- 분석 생성 프롬프트와 폴백 로직을 전면 개편해 문장별 해석·배경지식·사례·어휘 포인트·응원 이모지가 포함된 “교수님 매뉴얼” 포맷을 항상 보장합니다.
- AnalysisPage 상세 보기 UI를 동일 템플릿으로 리팩터링해 ①~⑳ 번호, 배경/사례 하이라이트, 어휘 표/동의어·반의어가 앱에서 그대로 노출됩니다.
- OpenAI 키 없이도 빠르게 결과를 받을 수 있도록 분석 폴백이 번역 호출을 생략하는 “Fast mode”로 동작하게 조정했습니다.
- 워크북 학습 메뉴가 분석 데이터를 활용해 자동으로 10단계 카드·미션을 생성하도록 서버/클라이언트 파이프라인을 구축했습니다.
- `/api/workbooks` REST 엔드포인트와 `workbook_sets` 테이블을 신설해 생성/조회 결과가 DB에 영구 저장됩니다.
- 라이트 모드 색상 팔레트를 재정비해 사이드바·카드·안내문이 모두 높은 대비로 표기됩니다.
- 어휘·학습·분석 화면을 단계별 URL(`/vocabulary/days`, `/study/solve`, `/analysis/detail`)로 분리해 브라우저 뒤로가기·딥링크를 지원합니다.
- StudyPage의 브라우저 히스토리 처리(`popstate`)를 안전한 순서로 재구성해 ReferenceError 없이 복귀/다시풀기 흐름이 동작합니다.
- 모바일 헤더/사이드바는 단일 토글과 outside-click 감지로 UX 혼선을 없앴습니다.

## 현재 단계 (2025-11-01 기준)
- 분석 생성과 프런트 렌더링이 교수님 매뉴얼 포맷(배경지식/사례/어휘/응원 이모지)으로 고정돼 학생 보기와 관리자 검수가 동일한 결과를 확인할 수 있습니다.
- 워크북 학습·테스트 파이프라인이 서버 DB와 연결되어 카드 학습 → 테스트 → 채점 흐름을 일괄 관리합니다.
- 어휘/학습/분석 단계가 주소로 분리되어 모바일·데스크톱 모두 브라우저 네이티브 전환감을 제공합니다.
- 라이트/다크 테마 대비가 정리돼 사이드바·단계 안내문·빈 상태 안내가 모두 높은 시인성을 가집니다.
- 학습 페이지의 히스토리 이동이 ReferenceError 없이 작동하며, 저장된 세션 복원도 안정화되었습니다.
- 자동 배포(Verce/Render)는 토큰·시크릿 보강 이후 연결 예정입니다.

## Next 3 (오늘 우선순위)
1. 분석·워크북 교수님 포맷을 캡처하는 Playwright/E2E 시나리오 작성 – 형식 회귀를 자동으로 차단↑
2. Render/Vercel 시크릿(`RENDER_DEPLOY_HOOK_URL`, `VERCEL_*`)과 토큰 검증 – main 푸시 즉시 배포 파이프라인 확보↑
3. 랭킹 API(leaderboard/tier-distribution) 500 에러 원인 분석 및 보정 – 실서비스 대시보드 신뢰도 회복↑

## Known Issues
- Playwright 스냅샷/시나리오가 아직 없어 분석·워크북 교수님 포맷 회귀를 사람이 직접 확인해야 합니다.
- 랭킹 API(leaderboard, tier-distribution)가 샘플 데이터 부족 시 500을 반환해 대시보드 요청이 실패합니다.
- Render/Vercel 시크릿 미설정으로 main 푸시 후 자동 배포가 막혀 있습니다.
- SMTP 자격 증명 미연결 상태라 이메일 인증/패스워드 초기화는 베타 우회 채널을 사용 중입니다.

## Resolved – 2025-11-01 (오류 반복 방지)
- 분석 프롬프트와 폴백 알고리즘을 재작성해 문장별 해석/배경/사례/어법/어휘가 교수님 매뉴얼 포맷과 동일하게 출력됩니다.
- AnalysisPage 상세 화면을 번호·배경/사례 강조·어휘 표 UI로 리디자인해 학생도 앱에서 동일한 완전 분석본을 확인합니다.
- DocumentAnalyzer meta 필드가 영어 제목 3개(질문형 포함), 실천 팁 3개를 강제하고, 워크북 서비스는 새 라벨(`이 문장에 필요한 배경지식/사례`, `어휘 포인트`)을 정상 파싱합니다.
- OpenAI 미사용 환경에서 분석 생성이 1분 이상 지연되던 문제를 해결해, 폴백 생성이 5~10초 내에 완료됩니다.
- 서버 단위 테스트(`npm test`)가 신규 포맷으로 모두 통과해 회귀 없이 배포 준비가 완료되었습니다.
