# PROJECT_STATE.md

## 우리가 만드는 것
- PDF나 텍스트 지문을 업로드하면 **수능 스타일 문제·해설·분석**을 자동으로 만들어 주는 학습 플랫폼.
- 학생은 웹에서 문제를 풀고 채점·해설·랭킹·신고 기능을 이용할 수 있어요.
- 선생님(관리자)은 분석본을 검수하고, 마음에 들지 않는 변형을 삭제하거나 신고를 처리할 수 있어요.

## 기술 스택 & 핵심 명령어
- **백엔드**: Node.js 20 + Express, SQLite(sql.js) / OpenAI API (fallback은 WordNet + 자체 로직)
- **프런트엔드**: React 19 (CRA), Zustand + SWR
- **공통 명령**
  - 개발: `npm run dev:all` (백엔드 5000, 프런트 3000)
  - 테스트: `npm test`
  - 프런트 빌드: `npm run build`
  - 린트: `npm run lint`

## 최근 결정/하이라이트
- 분석 자료 리스트/상세 화면을 다크 톤 카드로 재정비하고 `document_passage_labels` 테이블을 붙여 지문 표시 이름을 저장·수정할 수 있게 했습니다.
- VocabularyPage 히어로를 단순 안내 + CTA 구조로 정리해 “총 Day/누적 단어” 같은 혼란스러운 통계를 제거했습니다.
- 랭킹 페이지 상위 카드의 대비, 이름 색상, 실버 티어 배지를 🥈로 교체해 어두운 배경에서도 1~3위 이름과 LP가 선명하게 보입니다.
- mockExamService가 PDF를 찾지 못하거나 `pdf-parse`가 실패하면 기본 JSON 데이터를 자동으로 사용하고, `모의고사원문`·`모의고사 원문` 폴더 모두를 탐색하도록 보강했습니다.
- 분석 생성 프롬프트와 폴백 로직을 전면 개편해 문장별 해석·배경지식·사례·어휘 포인트·응원 이모지가 포함된 “교수님 매뉴얼” 포맷을 항상 보장합니다.
- AnalysisPage 상세 보기 UI를 동일 템플릿으로 리팩터링해 ①~⑳ 번호, 배경/사례 하이라이트, 어휘 표/동의어·반의어가 앱에서 그대로 노출됩니다.
- OpenAI 키 없이도 빠르게 결과를 받을 수 있도록 분석 폴백이 번역 호출을 생략하는 “Fast mode”로 동작하게 조정했습니다.
- 워크북 학습 메뉴가 분석 데이터를 활용해 자동으로 10단계 카드·미션을 생성하도록 서버/클라이언트 파이프라인을 구축했습니다.
- `/api/workbooks` REST 엔드포인트와 `workbook_sets` 테이블을 신설해 생성/조회 결과가 DB에 영구 저장됩니다.
- 라이트 모드 색상 팔레트를 재정비해 사이드바·카드·안내문이 모두 높은 대비로 표기됩니다.
- 어휘·학습·분석 화면을 단계별 URL(`/vocabulary/days`, `/study/solve`, `/analysis/detail`)로 분리해 브라우저 뒤로가기·딥링크를 지원합니다.
- StudyPage의 브라우저 히스토리 처리(`popstate`)를 안전한 순서로 재구성해 ReferenceError 없이 복귀/다시풀기 흐름이 동작합니다.
- 모바일 헤더/사이드바는 단일 토글과 outside-click 감지로 UX 혼선을 없앴습니다.
- 분석/관리자 리스트 UI를 고대비 카드·그라데이션 톤으로 통일해 모바일과 데스크톱 모두 같은 톤앤매너를 유지합니다.
- AnalysisPage와 VocabularyPage 상단 히어로를 메트릭 배지·검색 안내가 포함된 고대비 그라데이션 영역으로 재구성해 첫 화면에서 핵심 정보를 또렷하게 제공합니다.
- 모의고사 실전 모드(50분 타이머, 채점/복습, 프로 전용 AI 해설)를 구축해 학생이 바로 시험을 볼 수 있습니다.
- 관리자 페이지에 모의고사 문제지·정답 PDF 동시 업로드 기능을 추가해 실전 데이터를 코드 수정 없이 갱신할 수 있습니다.
- 홈 대시보드 히어로/하이라이트/CTA를 독수리 컬러(네이비·골드)와 미니 메트릭 카드로 재구성하고, 마스코트 애니메이션을 wink/cheer 루프로 보강해 브랜드 톤을 한 화면에서 전달합니다.

## 현재 단계 (2025-11-06 기준)
- 분석 생성과 프런트 렌더링이 교수님 매뉴얼 포맷(배경지식/사례/어휘/응원 이모지)으로 고정돼 학생 보기와 관리자 검수가 동일한 결과를 확인할 수 있습니다.
- 워크북 학습·테스트 파이프라인이 서버 DB와 연결되어 카드 학습 → 테스트 → 채점 흐름을 일괄 관리합니다.
- 어휘/학습/분석 단계가 주소로 분리되어 모바일·데스크톱 모두 브라우저 네이티브 전환감을 제공합니다.
- 라이트/다크 테마 대비가 정리돼 사이드바·단계 안내문·빈 상태 안내가 모두 높은 시인성을 가집니다.
- 학습 페이지의 히스토리 이동이 ReferenceError 없이 작동하며, 저장된 세션 복원도 안정화되었습니다.
- 모의고사 실전 모드가 PDF 파싱 → 타이머 → 채점 → 프로 전용 해설까지 한 플로우로 제공되어 베타 시험 리허설이 가능합니다.
- 관리자 포털 UI가 고대비 카드 스타일로 정리돼 문서/모의고사/신고 보드를 일관된 UX로 운영할 수 있습니다.
- 분석 자료 히어로 · 지문 카드가 다크 톤으로 정리돼 등록된 문서 수와 CTA만 노출되고, VocabularyPage 히어로도 단순 CTA 구조로 통일되었습니다.
- 자동 배포(Render/Vercel)는 토큰·시크릿 보강 이후 연결 예정입니다.

## Next 3 (오늘 우선순위)
1. [P0] 모의고사/어휘 Playwright 시나리오 추가 – 홈/히어로 리뉴얼까지 끝난 상태라 이제 전체 플로우를 자동 캡처해 회귀 시각증거를 확보해야 합니다.
2. [P1] 지문 이름 편집 UI 모달화 – `prompt` 입력을 즉시 대체해 모바일/IME 환경에서도 커스텀 라벨을 끊김 없이 수정할 수 있게 합니다.
3. [P1] 랭킹 API 시드·폴백 확장 – 빈 데이터에서도 500 대신 빈 상태 응답을 돌려 홈·랭킹 위젯이 항상 안전하게 로딩되도록 해야 합니다.

## Known Issues
- Playwright 스냅샷/시나리오가 없어 새 홈/어휘/모의고사 플로우를 사람이 직접 회귀 테스트해야 합니다.
- 랭킹 API(leaderboard, tier-distribution)가 샘플 데이터 부족 시 500을 반환해 홈 위젯이 실패합니다.
- 지문 이름 편집이 `prompt` 기반이라 모바일/IME 입력/검증/취소 흐름을 지원하지 못합니다.
- 모의고사 업로드는 현재 단일 회차(`2025-10`)만 지원해 다회차 관리 UI가 필요합니다.
- Workbook bulk 생성 결과 알림은 로그 중심이라 UI에서 실패 건수를 바로 확인하기 어렵습니다.
- SMTP 자격 증명이 없어 이메일 인증/비밀번호 초기화를 베타 우회 채널로 처리합니다.

## Resolved – 2025-11-07 (오류 반복 방지)
- 분석 자료 리스트/상세를 다크 톤 카드 + `document_passage_labels` 기반 이름 편집으로 재구성해 지문 라벨 혼선을 없앴습니다.
- VocabularyPage 히어로를 안내 + CTA만 남기는 구조로 바꿔 “총 Day/누적 단어” 같은 불명확한 통계를 제거했습니다.
- 랭킹 페이지 상위 카드 색 대비와 실버 티어 아이콘을 갱신해 1~3위 이름/LP가 어두운 배경에서도 선명하게 드러납니다.
- mockExamService가 PDF 경로를 찾지 못하거나 파싱에 실패하면 JSON 데이터를 자동으로 사용하고, `모의고사원문`/`모의고사 원문` 폴더 모두를 검사해 Render 500을 예방합니다.

## Resolved – 2025-11-08 (오류 반복 방지)
- 홈 히어로·하이라이트·CTA 컬러를 네이비/골드 팔레트로 재정비해 베타 사용자에게 일관된 브랜드 인상을 줍니다.
- 빠른 실행 버튼을 아이콘+텍스트 구조로 재구성해 모바일에서도 각 기능이 한눈에 들어오도록 했습니다.
- 마스코트 애니메이션을 wink/cheer 루프와 오라/그림자 레이어로 보강해 “멈춰 있는 캐릭터”처럼 보이던 문제를 제거했습니다.

## Resolved – 2025-11-06 (오류 반복 방지)
- AnalysisPage·VocabularyPage 히어로를 고대비 그라데이션과 메트릭 카드로 리뉴얼해 다크/라이트 테마 모두에서 지표가 선명하게 보입니다.
- 분석 자료·관리자 리스트를 고대비 카드 UI로 통일해 테마 혼선과 모바일 대비 부족 문제를 제거했습니다.
- 모의고사 실전 모드를 구축해 PDF → 문제/정답 파싱, 50분 타이머, 채점/복습, 프로 전용 AI 해설까지 한 플로우로 제공합니다.
- 관리자 페이지에 모의고사 문제지·정답 PDF 동시 업로드를 추가해 코드 수정 없이 실전 데이터를 갱신할 수 있습니다.
- MockExam 서비스가 캐시 리셋/파일 검증을 수행해 누락된 PDF나 잘못된 업로드로 인한 500 오류를 예방합니다.
