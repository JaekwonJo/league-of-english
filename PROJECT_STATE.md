# PROJECT_STATE.md

## 우리가 만드는 것
- PDF나 텍스트 지문을 업로드하면 **수능 스타일 문제·해설·분석**을 자동으로 만들어 주는 학습 플랫폼.
- 학생은 웹에서 문제를 풀고 채점·해설·랭킹·신고 기능을 이용할 수 있어요.
- 선생님(관리자)은 분석본을 검수하고, 마음에 들지 않는 변형을 삭제하거나 신고를 처리할 수 있어요.

## 기술 스택 & 핵심 명령어
- **백엔드**: Node.js 20 + Express, SQLite(sql.js) / OpenAI API (fallback은 WordNet + 자체 로직)
- **프런트엔드**: React 19 (CRA), Zustand + SWR
- **공통 명령**
  - 개발: `npm run dev:all` (백엔드 5000, 프런트 3000)
  - 테스트: `npm test`
  - 프런트 빌드: `npm run build`
  - 린트: `npm run lint`

## 최근 결정/하이라이트
- Vocabulary에 단일/복수 정답을 모두 지원해요. 메타데이터에 `answerMode(correct/incorrect)`·`answerIndices`·`optionStatuses`를 기록하고, 질문 문구(올바른 것/적절하지 않은 것/모두 고르시오)도 변형을 인식합니다.
- 분석(fallback) 결과를 문장별로 라벨링해 저장합니다: "한글 해석/분석/배경지식/사례/어법 포인트/어휘 포인트"가 빠짐없이 채워지며 최소 길이를 검증해 빈 템플릿을 차단했어요.
- 학습 화면(Study) 마무리 흐름을 개선했습니다. 전부 풀지 않아도 마무리 버튼을 눌러 빠진 번호를 안내받을 수 있고, 렌더링 최적화(useMemo)로 성능을 안정화했어요.
- 어휘 하이라이트·정규식 교체에서 공백 패턴 누락 문제를 수정해 밑줄 치환이 끊기지 않도록 했어요.
- 관련 테스트와 유틸을 보강하고, 테스트용 내보내기(__testables)를 추가해 라우트 단위 검증이 쉬워졌습니다.

## 현재 단계 (2025-10-22 기준)
- Vocabulary 다중 정답과 변형 질문이 안정화되었고, 분석(fallback) 라벨링·길이 검증으로 콘텐츠 품질을 보장합니다.
- 학습 마무리 UX가 개선되어 이탈/막힘을 줄였습니다. 다만 관리자 삭제 후 404와 랭킹/LP 반영은 추가 QA가 필요해요.
- 베타 배포 문서/스크립트는 최신이며, e2e 시나리오와 회귀 테스트를 더 넓히는 단계입니다.

## Next 3 (오늘 우선순위)
1. 관리자 삭제 후 404 재현+라우트 테스트 보강 – 실사용 중 가장 치명적인 중단 이슈예요.
2. Vocabulary 다중 정답 e2e+결과/LP/랭킹 연동 – 채점·통계가 정확해야 수업에 바로 씁니다.
3. PDF/리뷰 사유 내보내기·표시 정리 – 관리자 검수 속도를 올려 운영 효율을 높여요.

## Known Issues
- 관리자 분석 뷰 삭제/취소 흐름에 대한 통합 테스트 미흡(간헐적 404 가능성).
- Vocabulary 다중 정답의 결과 요약/LP/랭킹 반영 e2e 커버리지 부족.
- UI 캡처(`npm run capture:ui`)는 Playwright 설치 안내를 수동으로 따릅니다.
- Google Translate 무료 API 호출 제한으로 캐시 삭제 시 주의 필요.

## Resolved – 2025-10-22 (오류 반복 방지)
- Vocabulary 다중 정답 검증을 도입해 정답 개수 불일치·옵션 사유 누락을 조기 차단했어요.
- 분석(fallback) 결과를 "한글 해석/분석/배경/사례/어법/어휘 포인트"로 라벨링하고 최소 길이를 강제해 빈 템플릿 문제를 제거했어요.
- 밑줄 치환 정규식의 공백 처리 버그를 고쳐 하이라이트가 끊기지 않도록 했어요.
- 학습 마무리 버튼 동작을 개선해 미답 항목 안내로 막힘을 방지했어요.
