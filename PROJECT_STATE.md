# PROJECT_STATE.md

## 우리가 만드는 것
- PDF나 텍스트 지문을 업로드하면 **수능 스타일 문제·해설·분석**을 자동으로 만들어 주는 학습 플랫폼.
- 학생은 웹에서 문제를 풀고 채점·해설·랭킹·신고 기능을 이용할 수 있어요.
- 선생님(관리자)은 분석본을 검수하고, 마음에 들지 않는 변형을 삭제하거나 신고를 처리할 수 있어요.

## 기술 스택 & 핵심 명령어
- **백엔드**: Node.js 20 + Express, SQLite(sql.js) / OpenAI API (fallback은 WordNet + 자체 로직)
- **프런트엔드**: React 19 (CRA), Zustand + SWR
- **공통 명령**
  - 개발: `npm run dev:all` (백엔드 5000, 프런트 3000)
  - 테스트: `npm test`
  - 프런트 빌드: `npm run build`
  - 린트: `npm run lint`

## 최근 결정/하이라이트
- 어휘 훈련 흐름을 3단계(세트 → Day → 시험준비) 마법사로 재구성하고, 모바일에서도 헤더·테마 토글이 직관적으로 보이도록 정리했습니다.
- 분석 홈에 검색을 추가하고, 지문을 열 때 자동 분석이 실행되지 않도록 분리했습니다. 관리자는 체크박스로 분석본을 한 번에 선택 삭제할 수 있어요.
- 다크/라이트 테마 토글을 사이드바·모바일 상단에 복원하고, 분석·어휘 UI 토큰을 통일해 색상 대비를 바로잡았습니다.
- API 클라이언트에 `deleteVariants`를 추가하고, 서버에 일괄 삭제 엔드포인트를 도입해 관리자 삭제 시도마다 404가 나는 문제를 줄였습니다.
- Vocabulary/Analysis 컴포넌트의 상태 관리(useMemo/useCallback)와 타임아웃 처리를 보강해 시험/분석 화면에서 멈춤 없이 복귀할 수 있어요.

## 현재 단계 (2025-10-27 기준)
- Vocabulary 시험이 세트 선택 → Day 선택 → 시험 설정까지 단계별로 안내되며, 모바일에서도 동일한 흐름을 제공합니다.
- 분석 홈은 검색과 목록 전환만 담당하고, 지문 상세로 들어가야 분석을 불러오도록 분리했습니다.
- 관리자 분석 화면에서 분석본을 여러 개 고르고 삭제할 수 있고, 일괄 삭제 API가 연결돼 있습니다.
- 테마 토글을 라이트/다크 모두 지원하도록 복구했고, UI 토큰 정비를 통해 대비를 개선했습니다.
- Render/Vercel 배포 전 테스트(analysis fallback) 한 건이 실패한 상태이며, 수정 준비 중입니다.

## Next 3 (오늘 우선순위)
1. fallback 분석 생성이 테스트(`analysisFallbackVariant`) 요구 형식을 따르도록 프롬프트/후처리를 수정 – 자동 분석 신뢰도↑
2. 신규 어휘 3단계·분석 일괄 삭제 흐름의 E2E 스냅샷/플레이어 라벨링을 추가 – 회귀 방지↑
3. Render/Vercel 배포 스크립트를 재가동하고 배포 이후 Smoke 테스트 체크리스트를 갱신 – 운영 대응 속도↑

## Known Issues
- `analysisFallbackVariant.test.js`가 fallback 해석 prefix 누락으로 실패 중 – 프롬프트/포맷 교정 필요.
- 일부 문서 grade/school 메타값이 비어 있을 때 학생 노출 정책이 과/소노출될 수 있음(정책 튜닝 예정).
- 이메일 발송(NEVER/SMTP) 미설정 시 가입은 베타 우회로 통과 – 운영 전 SMTP 필수 세팅 필요.
- UI 캡처(`npm run capture:ui`) 최초 실행 시 Playwright 설치 필요.

## Resolved – 2025-10-27 (오류 반복 방지)
- 어휘 훈련을 단계별 UI로 바꾸고 안내 문구를 정리해 학생/모바일 사용자 혼란을 줄였습니다.
- 분석 홈과 지문 상세 로딩을 분리하고, 체크박스 기반 일괄 삭제로 관리자 반복 삭제 404를 줄였습니다.
- 다크/라이트 테마 토글과 분석 UI 토큰을 통일해 색상 대비 문제를 예방했습니다.
- `deleteVariants` API와 관리자 일괄 삭제 흐름을 서버·프런트 모두 연결해 삭제 실패 시 재시도 안내만 남도록 했습니다.
- 신규 흐름에 맞춘 문서/가이드를 동기화해 배포 시 혼선과 누락을 막았습니다.
